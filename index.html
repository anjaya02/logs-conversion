<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Log Converter</title>
    <style>
      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          Helvetica, Arial, sans-serif;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        margin: 0;
        background-color: #f4f7f6;
        color: #333;
      }
      #app-container {
        background: white;
        padding: 40px;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        text-align: center;
        width: 400px;
      }
      h2 {
        margin-top: 0;
        color: #1a1a1a;
      }
      form {
        display: flex;
        flex-direction: column;
        gap: 20px;
      }
      input[type="file"] {
        border: 2px dashed #ccc;
        border-radius: 6px;
        padding: 20px;
        background-color: #fafafa;
        cursor: pointer;
        transition: border-color 0.2s;
      }
      input[type="file"]::file-selector-button {
        margin-right: 15px;
        border: none;
        background: #007bff;
        padding: 10px 15px;
        border-radius: 5px;
        color: #fff;
        cursor: pointer;
        transition: background-color 0.2s;
      }
      input[type="file"]::file-selector-button:hover {
        background: #0056b3;
      }
      input[type="file"]:hover {
        border-color: #007bff;
      }
      button {
        padding: 12px;
        border: none;
        background-color: #28a745;
        color: white;
        border-radius: 5px;
        font-size: 16px;
        cursor: pointer;
        transition: background-color 0.2s;
      }
      button:hover {
        background-color: #218838;
      }
      button:disabled {
        background-color: #aaa;
        cursor: not-allowed;
      }
      #status {
        margin-top: 20px;
        font-size: 14px;
      }
      .spinner {
        border: 4px solid rgba(0, 0, 0, 0.1);
        width: 36px;
        height: 36px;
        border-radius: 50%;
        border-left-color: #007bff;
        animation: spin 1s ease infinite;
        margin: 20px auto 0;
        display: none;
      }
      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }
      .error {
        color: #d93025;
      }
      .success {
        color: #218838;
      }
    </style>
  </head>
  <body>
    <div id="app-container">
      <h2>Upload ZIP â†’ Get CSV</h2>
      <form id="upload-form">
        <input type="file" name="file" accept=".zip" required />
        <button type="submit">Convert</button>
      </form>
      <div id="spinner" class="spinner"></div>
      <div id="status"></div>
    </div>

    <script>
      const form = document.getElementById("upload-form");
      const submitButton = form.querySelector("button");
      const statusDiv = document.getElementById("status");
      const spinner = document.getElementById("spinner");
      const fileInput = form.querySelector('input[type="file"]');

      form.addEventListener("submit", async (event) => {
        event.preventDefault();

        // --- UI Feedback Start ---
        submitButton.disabled = true;
        submitButton.textContent = "Processing...";
        spinner.style.display = "block";
        statusDiv.textContent =
          "Uploading and processing file. This may take a moment, especially if the server is waking up...";
        statusDiv.className = "";

        const formData = new FormData();
        formData.append("file", fileInput.files[0]);

        try {
          const response = await fetch("/upload", {
            method: "POST",
            body: formData,
          });

          if (!response.ok) {
            const errorData = await response.json();
            throw new Error(errorData.error || "An unknown error occurred.");
          }

          // --- Handle File Download ---
          const blob = await response.blob();
          const url = window.URL.createObjectURL(blob);
          const a = document.createElement("a");
          a.style.display = "none";
          a.href = url;
          a.download = "merged_sorted.csv"; // The filename to save as
          document.body.appendChild(a);
          a.click();
          window.URL.revokeObjectURL(url);
          a.remove();

          statusDiv.textContent = "Success! Your CSV has been downloaded.";
          statusDiv.className = "success";
        } catch (error) {
          statusDiv.textContent = `Error: ${error.message}`;
          statusDiv.className = "error";
        } finally {
          // --- Reset UI ---
          submitButton.disabled = false;
          submitButton.textContent = "Convert";
          spinner.style.display = "none";
          form.reset(); // Clear the selected file
        }
      });
    </script>
  </body>
</html>
